<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance System - Department of Philosophy</title>
    <meta name="description" content="University of Chittagong - Department of Philosophy Attendance System">
    
    <!-- PWA Configuration -->
    <meta name="theme-color" content="#2c3e50">
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Attendance">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Android Chrome -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Attendance">
    
    <!-- External Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Custom JS (defer ব্যবহার করছি যাতে HTML লোড হওয়ার পর JS লোড হয়) -->
    <script src="app.js" defer></script>
</head>
<body>
    <!-- Network Status Indicator -->
    <div class="network-indicator">
        <div id="onlineIndicator" class="online-indicator">
            <i class="fas fa-wifi"></i> Online
        </div>
        <div id="offlineIndicator" class="offline-indicator">
            <i class="fas fa-wifi-slash"></i> Offline
        </div>
    </div>
    
    <!-- Welcome Screen -->
    <div id="welcomeAd" class="welcome-screen hidden">
        <div class="welcome-overlay">
            <div class="welcome-content">
                <i class="fas fa-graduation-cap welcome-icon"></i>
                <h2>Welcome to Attendance System</h2>
                <p>Department of Philosophy</p>
                <p>University of Chittagong</p>
                <div class="welcome-number">1</div>
                <p class="welcome-loading">Loading system...</p>
            </div>
        </div>
    </div>
    
    <!-- Login Screen -->
    <div id="loginScreen">
        <div class="login-header">
            <h1>Attendance System</h1>
            <p>Department of Philosophy</p>
        </div>
        
        <div class="login-body">
            <div class="login-icon-section">
                <i class="fas fa-user-shield login-icon"></i>
                <h2>Teacher Login</h2>
                <p>Enter credentials to access the system</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Your username" required>
                </div>
                
                <div class="form-group">
                    <label for="teacherName">
                        <i class="fas fa-user-tie"></i> Teacher Name
                    </label>
                    <input type="text" id="teacherName" placeholder="Enter your full name" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <div class="password-input">
                        <input type="password" id="password" placeholder="Your password" required>
                        <button type="button" id="togglePassword" class="password-toggle">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-login">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                
                <div class="demo-credentials">
                    <p><strong>Demo Access:</strong><br>Username: <code>teacher</code><br>Password: <code>philosophy123</code></p>
                    <p class="demo-warning">Change these credentials for production use</p>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Main Dashboard -->
    <div id="dashboardScreen" class="hidden">
        <div class="dashboard-header">
            <div class="header-content">
                <h1>Attendance System</h1>
                <p>Department of Philosophy</p>
            </div>
            <div class="user-info">
                <i class="fas fa-user-circle"></i>
                <span id="currentUser">Teacher</span>
                <button id="logoutBtn" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
        
        <div class="dashboard-body">
            <div class="dashboard-controls">
                <h2>Course List</h2>
                
                <div class="control-buttons">
                    <button id="addCourseBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> New Course
                    </button>
                    
                    <button id="searchCorrectionBtn" class="btn btn-warning">
                        <i class="fas fa-search"></i> Search & Correct
                    </button>
                    
                    <button id="dataManagementBtn" class="btn btn-info">
                        <i class="fas fa-database"></i> Data Management
                    </button>
                </div>
            </div>
            
            <div id="coursesGrid" class="courses-grid">
                <!-- Courses will be loaded here -->
            </div>
            
            <!-- Data Management Section -->
            <div id="dataManagementSection" class="data-management hidden">
                <h3><i class="fas fa-database"></i> Data Management</h3>
                
                <div class="data-section">
                    <h4>Backup & Restore</h4>
                    <div class="backup-options">
                        <button id="backupDataBtn" class="btn btn-success">
                            <i class="fas fa-download"></i> Backup Data
                        </button>
                        
                        <label class="btn btn-primary file-upload">
                            <i class="fas fa-upload"></i> Restore Data
                            <input type="file" id="restoreDataFile" accept=".json">
                        </label>
                        
                        <button id="clearAllDataBtn" class="btn btn-danger">
                            <i class="fas fa-trash-alt"></i> Clear All Data
                        </button>
                    </div>
                </div>
                
                <div class="data-section">
                    <h4>Import Students (CSV)</h4>
                    <p class="file-format">
                        Format: student_id,student_name,year,department (one student per line)
                    </p>
                    <div class="import-section">
                        <select id="importCourseSelect">
                            <option value="">Select Course</option>
                        </select>
                        
                        <label class="btn btn-warning file-upload">
                            <i class="fas fa-file-import"></i> Import CSV
                            <input type="file" id="importCSVFile" accept=".csv,.txt">
                        </label>
                    </div>
                </div>
                
                <div class="data-management-footer">
                    <button id="closeDataManagementBtn" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Search & Correction Section -->
    <div id="correctionSection" class="correction-section hidden">
        <h3><i class="fas fa-search"></i> Search & Correct Attendance</h3>
        
        <div class="correction-form">
            <div class="form-group">
                <label>Date</label>
                <input type="date" id="searchDate" required>
            </div>
            
            <div class="form-group">
                <label>Course</label>
                <select id="searchCourse" required>
                    <option value="">Select Course</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Student ID/Name</label>
                <input type="text" id="searchStudentId" placeholder="Enter Student ID or Name">
            </div>
        </div>
        
        <div class="correction-buttons">
            <button id="searchAttendanceBtn" class="btn btn-primary">
                <i class="fas fa-search"></i> Search
            </button>
            <button id="closeCorrectionBtn" class="btn btn-secondary">
                <i class="fas fa-times"></i> Close
            </button>
        </div>
        
        <div id="searchResults" class="search-results hidden">
            <!-- Search results will appear here -->
        </div>
    </div>
    
    <!-- Attendance Page -->
    <div id="attendanceScreen" class="hidden">
        <div class="attendance-header">
            <div class="attendance-header-content">
                <div>
                    <h1 id="attendanceCourseTitle">Course Attendance</h1>
                    <p id="attendanceCourseInfo">Course details</p>
                </div>
                <div class="attendance-user-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="attendanceUser">Teacher</span>
                </div>
            </div>
        </div>
        
        <div class="attendance-subheader">
            <div class="course-info">
                <div class="course-title" id="currentCourseTitle"></div>
                <div class="course-details" id="attendanceDatesInfo"></div>
            </div>
            
            <div class="attendance-controls">
                <button id="attendanceStartBtn" class="btn btn-start">
                    <i class="fas fa-play-circle"></i> Start Attendance
                </button>
                <button id="shareAttendanceBtn" class="btn btn-warning">
                    <i class="fas fa-share-alt"></i> Share
                </button>
            </div>
        </div>
        
        <!-- Attendance Table Container -->
        <div id="attendanceTableContainer" class="attendance-table-container hidden">
            <table id="attendanceTable">
                <thead id="attendanceTableHeader">
                    <!-- Headers will be generated dynamically -->
                </thead>
                <tbody id="attendanceTableBody">
                    <!-- Rows will be generated dynamically -->
                </tbody>
            </table>
        </div>
        
        <div class="attendance-footer">
            <button id="backToDashboardBtn" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </button>
            <button id="exportExcelBtn" class="btn btn-success hidden">
                <i class="fas fa-file-excel"></i> Excel Sheet
            </button>
            <button id="printSheetBtn" class="btn btn-primary hidden">
                <i class="fas fa-print"></i> Print
            </button>
        </div>
        
        <!-- Share Options -->
        <div id="shareOptions" class="share-options hidden">
            <h3><i class="fas fa-share-alt"></i> Share Attendance</h3>
            <div class="share-buttons">
                <button onclick="shareViaEmail()" class="btn btn-email">
                    <i class="fas fa-envelope"></i> Email
                </button>
                <button onclick="shareViaWhatsApp()" class="btn btn-whatsapp">
                    <i class="fab fa-whatsapp"></i> WhatsApp
                </button>
                <button onclick="copyToClipboard()" class="btn btn-primary">
                    <i class="fas fa-copy"></i> Copy Link
                </button>
                <button onclick="hideShareOptions()" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>
    
    <!-- Attendance Popup -->
    <div id="attendancePopupOverlay" class="attendance-popup-overlay hidden">
        <div class="attendance-popup">
            <div class="popup-student-info">
                <div class="student-id" id="popupStudentId">1001</div>
                <div class="student-name" id="popupStudentName">Student Name</div>
                <div class="student-details" id="popupStudentDetails">1st Year | Philosophy</div>
            </div>
            
            <div class="attendance-options">
                <button class="attendance-option-btn present-btn" onclick="markAttendance('present')">
                    <i class="fas fa-check-circle"></i> Present ✓
                </button>
                <button class="attendance-option-btn absent-btn" onclick="markAttendance('absent')">
                    <i class="fas fa-times-circle"></i> Absent ✗
                </button>
            </div>
            
            <div class="progress-section">
                <div class="progress-info">
                    <span id="currentProgress">0/0</span>
                    <span id="progressPercentage">0%</span>
                </div>
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
            </div>
            
            <div class="popup-footer">
                <button id="stopAttendanceBtn" class="btn btn-stop">
                    <i class="fas fa-stop-circle"></i> Stop Attendance
                </button>
            </div>
        </div>
    </div>
    
    <!-- Quick Correction -->
    <div id="quickCorrection" class="quick-correction hidden">
        <i class="fas fa-history"></i>
        <span id="quickCorrectionText">Last marked: Student ID - Present</span>
        <button onclick="undoLastAttendance()" class="btn btn-undo">
            <i class="fas fa-undo"></i> Undo
        </button>
        <button onclick="hideQuickCorrection()" class="btn btn-dismiss">
            <i class="fas fa-times"></i> Dismiss
        </button>
    </div>
    
    <!-- PWA Install Prompt -->
    <div id="installPrompt" class="install-prompt hidden">
        <h3><i class="fas fa-download"></i> Install Attendance System</h3>
        <p>Add to home screen for quick access</p>
        <div class="install-buttons">
            <button id="installBtn" class="btn btn-install">
                <i class="fas fa-download"></i> Install
            </button>
            <button id="dismissInstallBtn" class="btn btn-dismiss-install">
                <i class="fas fa-times"></i> Later
            </button>
        </div>
    </div>

    <!-- Notification Container (Dynamically Created) -->
    
    <!-- JavaScript -->
    <script>
        // Initialize app
        window.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing app...');
            
            // Show welcome screen
            document.getElementById('welcomeAd').classList.remove('hidden');
            
            setTimeout(() => {
                document.getElementById('welcomeAd').classList.add('hidden');
                
                // Check auto login
                if (!checkAutoLogin()) {
                    // Show login screen
                    document.getElementById('loginScreen').classList.remove('hidden');
                }
                
                // Initialize other components
                initializeApp();
            }, 1000);
        });
    </script>
</body>
</html>
